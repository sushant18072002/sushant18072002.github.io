<!DOCTYPE html>
<html>
<head>
    <title>Booking Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .result { background: #f9f9f9; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 14px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; background: #1976d2; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Booking Debug Test</h1>
        
        <div>
            <h3>Admin Login & Test</h3>
            <button onclick="loginAsAdmin()">Login as Admin</button>
            <button onclick="testAdminBookings()">Test Admin Bookings</button>
            <button onclick="testUserTrips()">Test User Trips</button>
            <button onclick="testDirectDB()">Test Direct DB Query</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let authToken = null;
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            results.appendChild(div);
        }
        
        async function apiCall(endpoint, options = {}) {
            try {
                const headers = { 'Content-Type': 'application/json', ...options.headers };
                if (authToken) headers['Authorization'] = `Bearer ${authToken}`;
                
                const response = await fetch(`${API_BASE}${endpoint}`, { headers, ...options });
                const data = await response.json();
                return { response, data, success: response.ok };
            } catch (error) {
                return { error: error.message, success: false };
            }
        }
        
        async function loginAsAdmin() {
            log('üîê Logging in as admin...');
            const { data, success } = await apiCall('/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email: 'admin@demo.com', password: 'admin123' })
            });
            
            if (success && data.success) {
                authToken = data.data.token;
                log(`‚úÖ Admin login successful. Role: ${data.data.user.role}`, 'success');
            } else {
                log(`‚ùå Admin login failed: ${data.message}`, 'error');
            }
        }
        
        async function testAdminBookings() {
            if (!authToken) {
                log('‚ùå Please login first', 'error');
                return;
            }
            
            log('üìã Testing admin bookings endpoint...');
            const { data, success, response } = await apiCall('/admin/bookings');
            
            log(`Response status: ${response.status}`);
            log(`Response data: ${JSON.stringify(data, null, 2)}`);
            
            if (success && data.success) {
                log(`‚úÖ Admin bookings: ${data.data.bookings?.length || 0} found`, 'success');
                if (data.data.bookings?.length > 0) {
                    data.data.bookings.forEach((booking, i) => {
                        log(`${i+1}. ${booking.bookingReference} - ${booking.status} - $${booking.pricing?.finalAmount || 0}`);
                    });
                }
            } else {
                log(`‚ùå Admin bookings failed: ${data.message || 'Unknown error'}`, 'error');
            }
        }
        
        async function testUserTrips() {
            if (!authToken) {
                log('‚ùå Please login first', 'error');
                return;
            }
            
            log('üåç Testing user trips endpoint...');
            const { data, success } = await apiCall('/user/trips');
            
            if (success && data.success) {
                const bookingTrips = data.data.trips?.filter(t => t.type === 'booking') || [];
                log(`‚úÖ User trips: ${bookingTrips.length} bookings found`, 'success');
                bookingTrips.forEach((trip, i) => {
                    log(`${i+1}. ${trip.reference} - ${trip.status} - $${trip.finalPrice || 0}`);
                });
            } else {
                log(`‚ùå User trips failed: ${data.message}`, 'error');
            }
        }
        
        async function testDirectDB() {
            log('üîç Testing if booking exists in database...');
            log('Check backend console for TripBooking.find() results');
            
            // This will trigger the backend logging
            await testAdminBookings();
        }
        
        window.onload = () => {
            log('üîç Booking Debug Test initialized');
            log('This will help identify why admin bookings tab is empty');
        };
    </script>
</body>
</html>